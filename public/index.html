<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity Organization</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
        }

        h1 {
            color: #333;
        }

        p {
            color: #666;
        }

        button {
            background-color: #008CBA;
            color: white;
            padding: 15px 25px;
            margin: 10px 0;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #005f73;
        }

        #donationProgress {
            font-weight: bold;
        }

        .container {
            width: 80%;
            max-width: 600px;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            text-align: center;
        }

        .donor-info {
            background: #e7e7e7;
            padding: 10px;
            margin-top: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Charity Organization</h1>
    <p>Total ETH Tokens Raised: <span id="totalTokens">0</span></p>
    <p>Goal: 100 ETH</p>
    <p>Donation Progress: <span id="donationProgress">0%</span></p>
    <button onclick="makeDonation()">Make Donation</button>

    <div class="donor-info">
        <p>Donor Last Donation: <span id="lastDonation">0 ETH</span></p>
        <p>Donor Total Donations: <span id="totalDonations">0 ETH</span></p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js"></script>
<script>
    const web3 = new Web3('http://localhost:8545'); // Connect to local Ganache node or change to your network URL
    const contractAbi = [
        {
            "inputs": [
                {
                    "internalType": "uint256",
                    "name": "initialSupply",
                    "type": "uint256"
                }
            ],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "donor",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "DonationReceived",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "donor",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "totalDonated",
                    "type": "uint256"
                }
            ],
            "name": "DonorUpdated",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "to",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "FundsWithdrawn",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "oldOwner",
                    "type": "address"
                },
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "newOwner",
                    "type": "address"
                }
            ],
            "name": "OwnershipTransferred",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "_to",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "_value",
                    "type": "uint256"
                }
            ],
            "name": "transfer",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "success",
                    "type": "bool"
                }
            ],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "from",
                    "type": "address"
                },
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "to",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "value",
                    "type": "uint256"
                }
            ],
            "name": "Transfer",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "newOwner",
                    "type": "address"
                }
            ],
            "name": "transferOwnership",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "_to",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "_amount",
                    "type": "uint256"
                }
            ],
            "name": "withdrawFunds",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "stateMutability": "payable",
            "type": "receive"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "_owner",
                    "type": "address"
                }
            ],
            "name": "balanceOf",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "balance",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "donors",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "totalDonated",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "lastDonationAmount",
                    "type": "uint256"
                },
                {
                    "internalType": "uint256",
                    "name": "donationCount",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "totalEthDonated",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "totalSupply",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ];
    const contractAddress = '0x6db3f445504C4b690c5c82C88274Bbb12Cabe4c2'; // Replace with your deployed contract address
    const myContract = new web3.eth.Contract(contractAbi, contractAddress);

    async function updateBalance() {
        const totalEthDonatedWei = await myContract.methods.totalEthDonated().call();
        const totalEthDonated = web3.utils.fromWei(totalEthDonatedWei, 'ether');

        document.getElementById('totalTokens').innerText = `${totalEthDonated} ETH`;

        const goal = 100;
        const progressPercent = (parseFloat(totalEthDonated) / goal) * 100;
        document.getElementById('donationProgress').innerText = `${progressPercent.toFixed(2)}%`;
    }

    async function updateDonorDetails(donorAddress) {
        const donorInfo = await myContract.methods.donors(donorAddress).call();
        const lastDonationEth = web3.utils.fromWei(donorInfo.lastDonationAmount, 'ether');
        const totalDonationsEth = web3.utils.fromWei(donorInfo.totalDonated, 'ether');

        document.getElementById('lastDonation').innerText = `${lastDonationEth} ETH`;
        document.getElementById('totalDonations').innerText = `${totalDonationsEth} ETH`;
    }

    async function makeDonation() {
        const accounts = await web3.eth.getAccounts();
        const senderAddress = accounts[0];
        const value = web3.utils.toWei('1', 'ether');

        try {
            const gasEstimate = await web3.eth.estimateGas({
                from: senderAddress,
                to: contractAddress,
                value: value
            });

            await web3.eth.sendTransaction({
                from: senderAddress,
                to: contractAddress,
                value: value,
                gas: gasEstimate // Use the estimated gas. You might want to add an extra amount to ensure it's sufficient.
            });
            await updateBalance();
            await updateDonorDetails(senderAddress);
        } catch (error) {
            console.error("Donation failed:", error);
        }
    }

    window.addEventListener('load', async () => {
        await updateBalance();
        // Call updateDonorDetails with the actual donor's address if needed

    });


</script>
</body>
</html>
